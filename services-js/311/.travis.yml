language: node_js
node_js:
- 8.4.0
env:
- TZ=America/New_York
before_script:
- npx -p greenkeeper-lockfile@1 greenkeeper-lockfile-update
# Kick of Percy in the before_script so that the visual diff
# processing is in parallel on Percy.io with the Jest testing
# below.
- npm run-script snapshot
script:
- npm run-script test-ci
after_script:
- npx codecov
- npx -p greenkeeper-lockfile@1 greenkeeper-lockfile-upload
branches:
  # We generally just care about PRs, but it's good to run on
  # the main branches so we know when the overall tree breaks.
  only:
  - master
  - develop
  # We need to run greenkeeper branches to get lockfile updates
  - /^greenkeeper\/.*$/
